<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - BlueVelvet Music Store</title>
    <link rel="stylesheet" href="../static/styles.css">
</head>
<body>
<nav class="navbar">
    <div class="logo">
        <img src="images/banana.png" alt="BlueVelvet Music Store" />
    </div>
    <ul class="nav-links">
        <li><a href="#">Articles</a></li>
        <li><a href="#">Brands</a></li>
        <li><a href="#">Categories</a></li>
        <li><a href="#">Customers</a></li>
        <li><a href="#">Menus</a></li>
        <li><a href="#">Orders</a></li>
        <li><a href="dashboard.html">Products</a></li>
        <li><a href="#">Sales Report</a></li>
        <li><a href="#">Settings</a></li>
        <li><a href="#">Shipping</a></li>
        <li><a href="#">Users</a></li>
    </ul>
</nav>

<div class="container">
    <h1>BlueVelvet Music Store</h1>
    <h2>Product Management</h2>

    <div>Welcome, Atticus (Administrator)
        <button id="logoutBtn">Logout</button>
    </div>

    <div id="productControls">
        <button id="resetProductsBtn">Reset Products to Initial State</button>
        <a href="create-product.html" type="submit"><button id="addProductBtn">Add Product</button></a>
        <input type="text" id="searchInput" placeholder="Search products...">
        <select id="sortSelect">
            <option value="name">Sort by Name</option>
            <option value="id">Sort by ID</option>
            <option value="brand">Sort by Brand</option>
            <option value="category">Sort by Category</option>
        </select>
    </div>

    <table id="productTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Image</th>
            <th>Name</th>
            <th>Brand</th>
            <th>Category</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="productList">
        <!-- Dynamic rows will be inserted here -->
        </tbody>
    </table>

    <div id="pagination" style="display:none;">
        <button id="firstPage">First...</button>
        <button id="prevPage">Prev</button>
        <button id="nextPage">Next</button>
        <button id="lastPage">...Last</button>
    </div>
</div>

<script>
    // Fetch products and display them
    document.addEventListener('DOMContentLoaded', () => {
        const apiUrl = 'http://localhost:8080/produtos';  // Adjust the API endpoint
        const productList = document.getElementById('productList');
        const searchInput = document.getElementById('searchInput');
        const sortSelect = document.getElementById('sortSelect');
        const paginationDiv = document.getElementById('pagination');

        let products = [];
        let currentPage = 1;
        const productsPerPage = 10;

        // Fetch the product data
        function fetchProducts() {
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Erro na requisição: ' + response.statusText);
                    return response.json();
                })
                .then(data => {
                    products = data;
                    displayProducts();
                    handlePagination();
                })
                .catch(error => console.error('Erro ao buscar produtos:', error));
        }

        // Display products in table
        function displayProducts() {
            const filteredProducts = filterAndSortProducts();
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const productsToDisplay = filteredProducts.slice(startIndex, endIndex);

            productList.innerHTML = '';
            productsToDisplay.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${product.produto_id}</td>
                <td><img src="${product.image_url}" alt="${product.product_name}" style="width: 100px; height: 100px;"></td>
                <td>${product.product_name}</td>
                <td>${product.brand}</td>
                <td>${product.category}</td>
                <td>
                    <button>View Details</button>
                    <button>Edit</button>
                    <button class="delete-btn">Delete</button>
                </td>
            `;
                productList.appendChild(row);
            });
        }

        // Filter and sort products
        function filterAndSortProducts() {
            let filtered = products.filter(product =>
                product.product_name.toLowerCase().includes(searchInput.value.toLowerCase())
            );

            if (sortSelect.value === 'name') {
                filtered.sort((a, b) => a.product_name.localeCompare(b.product_name));
            } else if (sortSelect.value === 'id') {
                filtered.sort((a, b) => a.id - b.id);
            } else if (sortSelect.value === 'brand') {
                filtered.sort((a, b) => a.brand.localeCompare(b.brand));
            } else if (sortSelect.value === 'category') {
                filtered.sort((a, b) => a.category.localeCompare(b.category));
            }

            return filtered;
        }

        // Handle pagination visibility and navigation
        function handlePagination() {
            if (products.length > productsPerPage) {
                paginationDiv.style.display = 'block';
            } else {
                paginationDiv.style.display = 'none';
            }
        }

        // Handle page navigation
        document.getElementById('firstPage').addEventListener('click', () => {
            currentPage = 1;
            displayProducts();
        });

        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayProducts();
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            if (currentPage * productsPerPage < products.length) {
                currentPage++;
                displayProducts();
            }
        });

        document.getElementById('lastPage').addEventListener('click', () => {
            currentPage = Math.ceil(products.length / productsPerPage);
            displayProducts();
        });

        // Search and sort event listeners
        searchInput.addEventListener('input', displayProducts);
        sortSelect.addEventListener('change', displayProducts);

        // Fetch products on page load
        fetchProducts();

        // Delete functionality (confirmation and removal)
        document.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-btn')) {
                const confirmation = confirm("Are you sure you want to delete this product?");
                if (confirmation) {
                    // Get product ID (this should be passed with the product)
                    const productId = event.target.closest('tr').querySelector('td').textContent;
                    deleteProduct(productId);
                }
            }
        });

        // Delete product (API or localStorage)
        function deleteProduct(productId) {
            // Call your API to delete product here, e.g.:
            fetch(`${apiUrl}/${productId}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(() => {
                    products = products.filter(product => product.id !== parseInt(productId));
                    displayProducts();
                })
                .catch(error => console.error('Erro ao excluir produto:', error));
        }
    });
</script>
</body>
</html>
